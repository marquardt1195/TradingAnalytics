"0","# Custom function to retrieve data for each symbol and merge with original table"
"0","retrieveAndMerge <- function(symbol, fromDate, toDate, addPercentChange) {"
"0","  # Retrieve data for the symbol"
"0","  data <- getSymbols(symbol, src = ""yahoo"", from = fromDate, to = toDate, auto.assign = FALSE)"
"0","  "
"0","  # Extract dates from Yahoo Finance data"
"0","  yahoo_dates <- index(data)"
"0","  "
"0","  # Create a data frame with dates and the symbol"
"0","  yahoo_data <- data.frame(Date = yahoo_dates, Symbol = symbol, data)"
"0","  "
"0","  # Merge the original table with the yahoo_data based on Date"
"0","  mergedTable <- merge(addPercentChange, yahoo_data, by = ""Symbol"", all.x = TRUE)"
"0","  "
"0","  return(mergedTable)"
"0","}"
"0",""
"0","# Initialize a list to store start dates for each Id"
"0","startDates <- list()"
"0",""
"0","# Loop through your table"
"0","for (i in 1:nrow(addPercentChange)) {"
"0","  symbol <- addPercentChange$Symbol[i]"
"0","  Id <- addPercentChange$Id[i]"
"0","  "
"0","  # Check if start date for this Id exists, if not, set it"
"0","  if (!(as.character(Id) %in% names(startDates))) {"
"0","    startDates[[as.character(Id)]] <- addPercentChange$tradeStartDate2[i]"
"0","  }"
"0","  "
"0","  fromDate <- startDates[[as.character(Id)]]"
"0","  toDate <- Sys.Date()  # Assuming you want data up to today's date"
"0","  "
"0","  # Retrieve and merge data for the current symbol"
"0","  mergedTable <- retrieveAndMerge(symbol, fromDate, toDate, addPercentChange[i, , drop = FALSE])"
"0","  "
"0","  # Assign the merged table to a variable with a unique name"
"0","  assign(paste(""merged_"", symbol, ""_Id_"", Id, sep = """"), mergedTable)"
"0","  "
"0","  # Update the start date if the next Id is different"
"0","  if (i < nrow(addPercentChange) && addPercentChange$Id[i+1] != Id) {"
"0","    nextId <- addPercentChange$Id[i+1]"
"0","    startDates[[as.character(nextId)]] <- addPercentChange$tradeStartDate2[i+1]"
"0","  }"
"0","}"
"0",""
"0","# Accessing each merged table"
"0","for (symbol in addPercentChange$Symbol) {"
"0","  for (Id in unique(addPercentChange$Id[addPercentChange$Symbol == symbol])) {"
"0","    mergedTableName <- paste(""merged_"", symbol, ""_Id_"", Id, sep = """")"
"0","    print(paste(""Merged table:"", mergedTableName))"
"0","    print(head(get(mergedTableName)))"
"0","  }"
"0","}"
"1","[1]"
"1"," ""Merged table: merged_ABNB_Id_1"""
"1","
"
